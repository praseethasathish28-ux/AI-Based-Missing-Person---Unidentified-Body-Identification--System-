<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Missing Person â€” Upload & Scan</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<style>
  :root{--accent:#00ff9d;--accent2:#00c3ff}
  html,body{height:100%;margin:0;font-family:Inter, "Poppins", Arial;background:#071226;color:#dfffe8}
  body{
    background: linear-gradient(120deg,#071226 0%, #0b2a3a 50%, #071227 100%);
    background-size:300% 300%; animation: bgMove 12s linear infinite;
    display:flex;align-items:center;justify-content:center;padding:28px;
  }
  @keyframes bgMove{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}
  .card{width:980px;max-width:100%;display:grid;grid-template-columns:460px 1fr;gap:20px;background:rgba(255,255,255,0.03);border-radius:14px;padding:18px;box-shadow:0 20px 60px rgba(0,0,0,0.6)}
  .left,.right{padding:12px}
  .title{font-size:20px;font-weight:700;color:#dfffe8;margin-bottom:8px}
  .form-row{display:flex;flex-direction:column;gap:10px;margin-bottom:12px}
  input[type="text"], input[type="number"]{padding:10px;border-radius:8px;border:none;background:#061324;color:#dfffe8}
  label.filebox{display:block;padding:12px;background:#061427;border-radius:10px;border:1px dashed rgba(255,255,255,0.03);cursor:pointer}
  input[type=file]{display:none}

  .preview-box{margin-top:12px;height:360px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));display:flex;align-items:center;justify-content:center;position:relative;overflow:hidden;border:1px solid rgba(255,255,255,0.03)}
  .preview-box img{max-width:100%;max-height:100%;object-fit:contain;transform-origin:center;transition:transform 300ms ease;border-radius:8px}

  .laser{position:absolute;left:0;right:0;height:5px;background:linear-gradient(90deg, rgba(0,0,0,0), var(--accent), rgba(0,0,0,0));filter:drop-shadow(0 0 18px var(--accent));transform:translateY(-200%);display:none;z-index:10}
  .scan-ring{position:absolute;width:70%;height:70%;border-radius:50%;border:2px solid rgba(0,255,157,0.07);pointer-events:none;transform:scale(1);transition:transform 0.6s ease}

  .btn{margin-top:10px;padding:12px;border-radius:10px;border:none;background:linear-gradient(90deg,var(--accent2),var(--accent));color:#021018;font-weight:700;cursor:pointer}
  .btn[disabled]{opacity:0.45;cursor:not-allowed}

  .logs{background:#061325;padding:12px;border-radius:10px;color:#bfeff0;height:300px;overflow:auto;border:1px solid rgba(255,255,255,0.02)}
  .log-item{font-family:monospace;font-size:13px;margin:6px 0;opacity:0.95}
  .hint{font-size:13px;color:#9fe8d9;margin-top:10px}

  @media(max-width:980px){.card{grid-template-columns:1fr}}
</style>
</head>
<body>
  <div class="card">
    <div class="left">
      <div class="title">Upload & Scan (Stage 1: Police)</div>
      <form id="scanForm" action="/search" method="POST" enctype="multipart/form-data">
        
        <div class="form-row">
          <input name="name" id="nameField" type="text" placeholder="Name" required>
          <input name="age" id="ageField" type="number" placeholder="Age" required>
          <input name="last_seen" id="locationField" type="text" placeholder="Last seen location" required>
        </div>

        <label class="filebox">
          ðŸ“¸ Choose image to upload
          <input id="photoInput" type="file" name="photo" accept="image/*" required>
        </label>

        <div class="preview-box" id="previewBox">
          <div class="scan-ring" id="scanRing"></div>
          <div class="laser" id="laser"></div>
          <img id="previewImage" alt="preview" style="display:none">
        </div>

        <div style="display:flex;gap:8px">
          <button type="button" id="startScanBtn" class="btn" disabled>Scan Image</button>
          <button type="submit" id="submitBtn" class="btn" style="display:none">Submit Search</button>
        </div>

        <div class="hint">Fill everything + upload photo â†’ Scan â†’ Submit appears</div>
      </form>
    </div>

    <div class="right">
      <div class="title">Stage Logs</div>
      <div class="logs" id="logsBox">
        <div class="log-item">Waiting for fields...</div>
      </div>
    </div>
  </div>

<script>
const nameField = document.getElementById("nameField");
const ageField = document.getElementById("ageField");
const locationField = document.getElementById("locationField");
const photoInput = document.getElementById("photoInput");

const startScanBtn = document.getElementById("startScanBtn");
const submitBtn = document.getElementById("submitBtn");

const previewImage = document.getElementById('previewImage');
const previewBox = document.getElementById('previewBox');

const laser = document.getElementById('laser');
const scanRing = document.getElementById('scanRing');

const logsBox = document.getElementById('logsBox');

let objectURL = null;
let scanRunning = false;

// Log helper
function log(t){
  let div=document.createElement("div");
  div.className="log-item";
  div.textContent=t;
  logsBox.appendChild(div);
  logsBox.scrollTop=logsBox.scrollHeight;
}

// Check if all required fields + image are present
function checkReady() {
  if (
    nameField.value.trim() !== "" &&
    ageField.value.trim() !== "" &&
    locationField.value.trim() !== "" &&
    photoInput.files.length > 0
  ) {
    startScanBtn.disabled = false;
    log("All fields filled. You can start scan.");
  } else {
    startScanBtn.disabled = true;
  }
}

nameField.addEventListener("input", checkReady);
ageField.addEventListener("input", checkReady);
locationField.addEventListener("input", checkReady);
photoInput.addEventListener("change", () => {
  checkReady();

  const file = photoInput.files[0];
  if (!file) return;

  if (objectURL) URL.revokeObjectURL(objectURL);
  objectURL = URL.createObjectURL(file);

  previewImage.src = objectURL;
  previewImage.style.display = "block";

  log("Image loaded.");
});

// SCAN animation
startScanBtn.addEventListener("click", () => {
  if (scanRunning) return;
  scanRunning = true;

  startScanBtn.disabled = true;
  log("Starting simulated scan...");

  laser.style.display = "block";
  scanRing.style.transform = "scale(1.05)";

  const duration = 2500;
  const stepTime = 20;
  let step = 0;
  const totalSteps = duration / stepTime;

  function animate() {
    step++;

    const pct = step / totalSteps;
    const boxH = previewBox.clientHeight;
    const posY = pct * (boxH + 20) - 10;

    laser.style.transform = `translateY(${posY}px)`;

    if (step < totalSteps) {
      setTimeout(animate, stepTime);
    } else {
      laser.style.display = "none";
      scanRing.style.transform = "scale(1)";
      scanRunning = false;

      log("Scan completed âœ“");
      submitBtn.style.display = "inline-block";
    }
  }
  animate();
});
</script>

</body>
</html>
